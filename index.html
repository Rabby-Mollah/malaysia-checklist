<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>🇲🇾 Malaysia Travel Checklist</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 2rem;
      background: #fdfdfd;
    }
    h1, h2, h3 {
      color: #00695c;
    }
    section {
      margin-bottom: 2rem;
    }
    label {
      display: block;
      margin: 5px 0;
    }
    .subsection {
      margin-left: 20px;
      margin-top: 0.5rem;
    }
    .category {
      background: #e0f2f1;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1.5rem;
    }
  </style>
</head>
<body>
  <h1>🇲🇾 Malaysia Travel Checklist</h1>
  <div id="checklist"></div>

  <!-- Firebase Scripts -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getDatabase, ref, onValue, set, update } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAHmfhuVUXQmSlUn4UP2Q9wzNdbg-OOHs4",
      authDomain: "malaysiachecklist.firebaseapp.com",
      projectId: "malaysiachecklist",
      storageBucket: "malaysiachecklist.firebasestorage.app",
      messagingSenderId: "962444265039",
      appId: "1:962444265039:web:f85506e13848ba8e278c3a",
      measurementId: "G-Q0CFSCM88W",
      databaseURL: "https://malaysiachecklist-default-rtdb.asia-southeast1.firebasedatabase.app"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const userId = "demo-user"; // Change to unique ID if needed
    const checklistContainer = document.getElementById('checklist');

    const checklistData = {
      "🍛 Top Traditional Malaysian Dishes": {
        "🇲🇾 Malay Dishes": [
          "Nasi Lemak",
          "Rendang",
          "Satay",
          "Laksa: Penang Asam Laksa",
          "Laksa: Curry Laksa",
          "Nasi Kerabu"
        ],
        "🇨🇳 Chinese-Malaysian Dishes": [
          "Char Kway Teow",
          "Hokkien Mee: KL version",
          "Hokkien Mee: Penang version",
          "Chee Cheong Fun",
          "Yong Tau Foo"
        ],
        "🇮🇳 Indian-Malaysian Dishes": [
          "Roti Canai",
          "Nasi Kandar",
          "Thosai (Dosa)",
          "Tandoori Chicken"
        ],
        "🍢 Street Food & Snacks": [
          "Apam Balik",
          "Cendol",
          "Rojak",
          "Lok Lok",
          "Keropok Lekor"
        ],
        "🍹 Drinks & Desserts": [
          "Teh Tarik",
          "Milo Dinosaur",
          "ABC (Ais Batu Campur)",
          "Kuih-muih"
        ]
      },
      "🇲🇾 Top Places to Visit in Malaysia": {
        "📍 Kuala Lumpur (Capital City)": [
          "Petronas Twin Towers",
          "Batu Caves",
          "Bukit Bintang",
          "KL Tower",
          "Thean Hou Temple"
        ],
        "📍 Penang": [
          "George Town",
          "Kek Lok Si Temple",
          "Penang Hill",
          "Penang Street Food"
        ],
        "📍 Langkawi (Island Paradise)": [
          "Langkawi Sky Bridge",
          "Pantai Cenang",
          "Island hopping tours",
          "Mangrove tours"
        ],
        "📍 Cameron Highlands (Cool Climate)": [
          "BOH Tea Plantations",
          "Strawberry farms",
          "Mossy Forest"
        ],
        "📍 Melaka (Historical City)": [
          "Dutch Square",
          "St. Paul’s Hill & Church",
          "Jonker Street",
          "Melaka River Cruise"
        ],
        "📍 Taman Negara (Oldest Rainforest)": [
          "Canopy Walkway",
          "Night jungle walks",
          "Orang Asli village"
        ],
        "📍 Sabah (Borneo)": [
          "Mount Kinabalu",
          "Kota Kinabalu",
          "Sipadan Island",
          "Kinabatangan River"
        ],
        "📍 Sarawak (Borneo)": [
          "Kuching",
          "Bako National Park",
          "Semenggoh Wildlife Centre"
        ],
        "🏝️ Off-the-Beaten-Path Islands": [
          "Perhentian Islands",
          "Tioman Island",
          "Redang Island"
        ]
      }
    };

    function renderChecklist(state = {}) {
      checklistContainer.innerHTML = '';
      Object.entries(checklistData).forEach(([section, subsections]) => {
        const sectionDiv = document.createElement('section');
        const sectionHeader = document.createElement('h2');
        sectionHeader.textContent = section;
        sectionDiv.appendChild(sectionHeader);

        Object.entries(subsections).forEach(([sub, items]) => {
          const subDiv = document.createElement('div');
          const subHeader = document.createElement('h3');
          subHeader.textContent = sub;
          subDiv.classList.add('subsection');
          subDiv.appendChild(subHeader);

          items.forEach(item => {
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.id = `${section}-${sub}-${item}`;
            checkbox.checked = !!state[checkbox.id];
            checkbox.addEventListener('change', () => {
              update(ref(db, `users/${userId}/checklist`), {
                [checkbox.id]: checkbox.checked
              });
            });

            const label = document.createElement('label');
            label.appendChild(checkbox);
            label.append(` ${item}`);
            subDiv.appendChild(label);
          });

          sectionDiv.appendChild(subDiv);
        });

        checklistContainer.appendChild(sectionDiv);
      });
    }

    // Fetch saved checklist state
    const userRef = ref(db, `users/${userId}/checklist`);
    onValue(userRef, (snapshot) => {
      const data = snapshot.val() || {};
      renderChecklist(data);
    });
  </script>
</body>
</html>
